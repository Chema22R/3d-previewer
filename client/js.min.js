function controller3D(){function e(){requestAnimationFrame(e),i.render(n,o)}function t(e,t){if("stl"===t.type){if(t.vertices.length>0&&e.addAttribute("position",new THREE.BufferAttribute(new Float32Array(t.vertices),3)),t.normals.length>0){for(var n=[],o=0;o<t.normals.length;o+=3)n.push(t.normals[o],t.normals[o+1],t.normals[o+2]),n.push(t.normals[o],t.normals[o+1],t.normals[o+2]),n.push(t.normals[o],t.normals[o+1],t.normals[o+2]);e.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(n),3))}}else"ply"===t.type?(t.indices.length>0&&e.setIndex(t.indices),t.vertices.length>0&&e.addAttribute("position",new THREE.Float32BufferAttribute(t.vertices,3)),t.normals.length>0&&e.addAttribute("normal",new THREE.Float32BufferAttribute(t.normals,3)),e.computeBoundingSphere()):"obj"===t.type&&(t.vertices.length>0&&e.addAttribute("position",new THREE.Float32BufferAttribute(t.vertices,3)),t.normals.length>0&&e.addAttribute("normal",new THREE.Float32BufferAttribute(t.normals,3)));return e}var n,o,r,i,a,s,c,l,u,p,h,f=$(".previewControl.wrapper"),d=new CP(document.querySelector(".palette.icon")).set("#aaaaaa");this.init=function(){n=new THREE.Scene,o=new THREE.PerspectiveCamera(75,f.width()/f.height(),1,1e3),o.position.set(0,0,100),n.add(o),r=new THREE.HemisphereLight(16777215,0,1),o.add(r),i=new THREE.WebGLRenderer({canvas:$("canvas.previewControl").get(0),antialias:!0}),i.setPixelRatio(window.devicePixelRatio),i.setSize(f.width(),f.height()),i.setClearColor(2105376),a=new THREE.OrbitControls(o,i.domElement),s=new THREE.MeshPhongMaterial({color:11184810,shading:THREE.FlatShading,wireframe:!1}),c=new THREE.MeshBasicMaterial({color:11184810,shading:THREE.SmoothShading,wireframe:!0,wireframeLinewidth:1}),l=new THREE.Box3,e()},this.loadMesh=function(e){if(p?(n.remove(p),d.set("#aaaaaa"),s.color.setHex("0xaaaaaa"),c.color.setHex("0xaaaaaa")):$(".navbar.right").fadeIn("slow"),a.reset(),u=t(new THREE.BufferGeometry,e),u.center(),p=new THREE.Mesh(u,s),h=l.setFromObject(p).getSize(),h.x<100&&h.y<100&&h.z<100||h.x>100||h.y>100||h.z>100){var o=h.x;o<h.y&&(o=h.y),o<h.z&&(o=h.z),p.scale.multiplyScalar(100/o)}n.add(p)},$(window).resize(function(){o.aspect=f.width()/f.height(),o.updateProjectionMatrix(),i.setSize(f.width(),f.height())}),$(".navbar.right .reset.icon").click(function(e){e.preventDefault(),p.rotation.x=0,p.rotation.y=0,p.rotation.z=0,a.reset()}),$(".rotatorArrows *").click(function(e){e.preventDefault();var t=new THREE.Matrix4;switch($(this).attr("class").split(" ")[0]){case"icon-arrow-up":t.makeRotationAxis(new THREE.Vector3(1,0,0).normalize(),Math.PI/2);break;case"icon-arrow-down":t.makeRotationAxis(new THREE.Vector3(1,0,0).normalize(),-Math.PI/2);break;case"icon-arrow-right":t.makeRotationAxis(new THREE.Vector3(0,1,0).normalize(),-Math.PI/2);break;case"icon-arrow-left":t.makeRotationAxis(new THREE.Vector3(0,1,0).normalize(),Math.PI/2)}p.matrix=t.multiply(p.matrix),p.rotation.setFromRotationMatrix(p.matrix)}),$(".navbar.right .wireframe.icon").click(function(e){e.preventDefault(),p.material.uuid===s.uuid?p.material=c:p.material=s}),d.on("change",function(e){p&&(s.color.setHex("0x"+e),c.color.setHex("0x"+e))})}var serverAddress="localhost",serverPort="8081";$(function(){function e(e){var t=["stl","ply","obj"];for(i=0;i<t.length;i++)if(t[i]==e.toLowerCase())return!0;return!1}function t(e,t){$(".stateMessage").text(e).css({color:"white",background:t}).fadeIn("slow",function(){setTimeout(function(){$(".stateMessage").fadeOut("slow")},2e3)})}$(".navbar.top input[type='file'].fileUpload").change(function(n){n.preventDefault();var o=$(this).get(0).files[0];if(e(o.name.substring(o.name.lastIndexOf(".")+1))){var r=new FormData;r.append("file",o),$(".loadingBar.wrapper").fadeIn("slow"),$.ajax({url:"http://"+serverAddress+":"+serverPort+"/api/file",method:"POST",data:r,processData:!1,contentType:!1,success:function(e,n){$(".loadingBar.wrapper").fadeOut("slow"),t("File uploaded successfully","green"),controller3D.loadMesh(e)},error:function(e,n,o){$(".loadingBar.wrapper").fadeOut("slow"),o?t(e.responseText,"red"):t("Unable to connect to server","red")}})}else t("Extension not supported. You can use stl, ply, obj","red")})}),$(function(){function e(e){if(0==e.length)$(".fileList.entries").css("padding","30px").text("No hay elementos para mostrar");else{$(".fileList.entries").css("padding","0px");for(var n=0;n<e.length;n++)$("<div class='"+e[n]._id+" fileList entry'><div class='"+e[n]._id+" fileList info pointer' title='"+e[n].name+"'><p class='fileList name'>"+e[n].name+"</p><p class='fileList date'>"+new Date(e[n].date).toLocaleString()+"</p></div><span class='"+e[n]._id+" fileList icon-delete pointer' title='delete "+e[n].name+"'></span></div>").appendTo(".fileList.entries")}$(".fileList.menu").fadeIn("slow"),setTimeout(function(){$(".fileList.menu").scrollTop(0),$(".scroll").perfectScrollbar("update"),t()},10)}function t(){$(".fileList.menu .fileList.info").click(function(e){e.preventDefault();var t=$(this).attr("class").split(" ")[0],o=this.parentNode.parentNode;$(".loadingBar.wrapper").fadeIn("slow"),$.ajax({url:"http://"+serverAddress+":"+serverPort+"/api/file/"+t,method:"GET",success:function(e,t){$(".loadingBar.wrapper").fadeOut("slow"),$(".fileList.menu").fadeOut("slow",function(){for(;o.childNodes.length>0;)o.childNodes[0].remove();$(".fileList.menu .fileList.search").val("")}),controller3D.loadMesh(e)},error:function(e,t,o){$(".loadingBar.wrapper").fadeOut("slow"),o?n(e.responseText,"red"):n("Unable to connect to server","red")}})}),$(".fileList.menu .fileList.icon-delete").click(function(e){e.preventDefault();var t=$(this).attr("class").split(" ")[0],o=this.parentNode;$.ajax({url:"http://"+serverAddress+":"+serverPort+"/api/file/"+t,method:"DELETE",success:function(e,t){$(o).hide(400,"linear",function(){o.remove()})},error:function(e,t,o){o?n(e.responseText,"red"):n("Unable to connect to server","red")}})})}function n(e,t){$(".stateMessage").text(e).css({color:"white",background:t}).fadeIn("slow",function(){setTimeout(function(){$(".stateMessage").fadeOut("slow")},2e3)})}$(".navbar.top .fileList.icon").click(function(t){t.preventDefault(),$.ajax({url:"http://"+serverAddress+":"+serverPort+"/api/file",method:"GET",success:function(t,n){e(t)},error:function(e,t,o){o?n(e.responseText,"red"):n("Unable to connect to server","red")}})}),$(window).on("mousedown touchstart",function(e){if(!$(e.target).is(".fileList")&&"none"!=$(".fileList.menu").css("display")){var t=$(".fileList.entries")[0];$(".fileList.menu").fadeOut("slow",function(){for(;t.childNodes.length>0;)t.childNodes[0].remove();$(".fileList.menu .fileList.search").val("")})}}),$(".fileList.menu .fileList.search").on("input propertychange change",function(e){e.preventDefault();var t=$(this).val().toLowerCase().trim();$(".fileList.name").html(function(e,n){n.toLowerCase().includes(t)?$(this).parent().parent().show():$(this).parent().parent().hide()}),$(".fileList.date").html(function(e,n){n.toLowerCase().includes(t)&&$(this).parent().parent().show()})})}),function(e,t){function n(e){return"undefined"!=typeof e}function o(e){return"string"==typeof e}function r(e){return"object"==typeof e}function i(e){return Object.keys(e).length}function a(e,t,n){return e<t?t:e>n?n:e}function s(e,t){return parseInt(e,t||10)}function c(e){return Math.round(e)}function l(e){var t,n,o,r,i,a,s,l,u=+e[0],p=+e[1],h=+e[2];switch(r=Math.floor(6*u),i=6*u-r,a=h*(1-p),s=h*(1-i*p),l=h*(1-(1-i)*p),r=r||0,s=s||0,l=l||0,r%6){case 0:t=h,n=l,o=a;break;case 1:t=s,n=h,o=a;break;case 2:t=a,n=h,o=l;break;case 3:t=a,n=s,o=h;break;case 4:t=l,n=a,o=h;break;case 5:t=h,n=a,o=s}return[c(255*t),c(255*n),c(255*o)]}function u(e){return h(l(e))}function p(e){var t,n=+e[0],o=+e[1],r=+e[2],i=Math.max(n,o,r),a=Math.min(n,o,r),s=i-a,c=0===i?0:s/i,l=i/255;switch(i){case a:t=0;break;case n:t=o-r+s*(o<r?6:0),t/=6*s;break;case o:t=r-n+2*s,t/=6*s;break;case r:t=n-o+4*s,t/=6*s}return[t,c,l]}function h(e){var t=+e[2]|+e[1]<<8|+e[0]<<16;return t="000000"+t.toString(16),t.slice(-6)}function f(e){return p(d(e))}function d(e){return 3===e.length&&(e=e.replace(/./g,"$&$&")),[s(e[0]+e[1],16),s(e[2]+e[3],16),s(e[4]+e[5],16)]}function m(e){return[+e[0]/360,+e[1]/100,+e[2]/100]}function v(e){return[c(360*+e[0]),c(100*+e[1]),c(100*+e[2])]}function E(e){return[+e[0]/255,+e[1]/255,+e[2]/255]}function w(e){if(r(e))return e;var t=/\s*rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)\s*$/i.exec(e),n=/\s*hsv\s*\(\s*(\d+)\s*,\s*(\d+)%\s*,\s*(\d+)%\s*\)\s*$/i.exec(e),o="#"===e[0]&&e.match(/^#([\da-f]{3}|[\da-f]{6})$/i);return o?f(e.slice(1)):n?m([+n[1],+n[2],+n[3]]):t?p([+t[1],+t[2],+t[3]]):[0,1,1]}var g="__instance__",T="firstChild",b="scrollRight",O="scrollTop",R="offsetLeft",y="offsetTop",H=setTimeout,x={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)},any:function(){return x.Android()||x.BlackBerry()||x.iOS()||x.Opera()||x.Windows()}};(function(e){e.version="1.3.3",e[g]={},e.each=function(t,n){return H(function(){var n,o=e[g];for(n in o)t(o[n],n,o)},0===n?0:n||1),e},e.parse=w,e._HSV2RGB=l,e._HSV2HEX=u,e._RGB2HSV=p,e._HEX2HSV=f,e._HEX2RGB=function(e){return E(d(e))},e.HSV2RGB=function(e){return l(m(e))},e.HSV2HEX=function(e){return u(m(e))},e.RGB2HSV=function(e){return v(p(e))},e.RGB2HEX=h,e.HEX2HSV=function(e){return v(f(e))},e.HEX2RGB=d})(e.CP=function(s,c){function p(e,t,n){e=e.split(/\s+/);for(var o=0,r=e.length;o<r;++o)t.addEventListener(e[o],n,!1)}function h(e,t,n){e=e.split(/\s+/);for(var o=0,r=e.length;o<r;++o)t.removeEventListener(e[o],n)}function f(e,t){var n=t.touches?t.touches[0].pageX:t.pageX,o=t.touches?t.touches[0].pageY:t.pageY,r=d(e);return{x:n-r.l,y:o-r.t}}function d(t){if(t===e)var n=e.pageYOffset||V[O],o=e.pageXOffset||V[b];else for(var n=t[y],o=t[R];t=t.offsetParent;)n+=t[y],o+=t[R];return{l:o,t:n}}function m(e,t){for(;(e=e.parentElement)&&e!==t;);return e}function v(e){e&&e.preventDefault()}function E(t){return t===e?{w:e.innerWidth,h:e.innerHeight}:{w:t.offsetWidth,h:t.offsetHeight}}function w(e){return B||!!n(e)&&e}function A(e){B=e}function $(e,t,o){return n(e)?n(t)?(n(I[e])||(I[e]={}),n(o)||(o=i(I[e])),I[e][o]=t,D):I[e]:I}function M(e,t){return n(e)?n(t)?(delete I[e][t],D):(I[e]={},D):(I={},D)}function L(e,t,o){if(!n(I[e]))return D;if(n(o))n(I[e][o])&&I[e][o].apply(D,t);else for(var r in I[e])I[e][r].apply(D,t);return D}function P(e,t){e&&"h"!==e||L("change:h",t),e&&"sv"!==e||L("change:sv",t),L("change",t)}function S(){return U.parentNode}function k(n,o){function r(e){var t=e.target,n=t===s||m(t,s)===s;n&&!D.visible?k():D.exit(),L(n?"enter":"exit",[D])}function i(e){var t=(l(Q),l([Q[0],1,1]));K.style.backgroundColor="rgb("+t.join(",")+")",A(Q),v(e)}function d(e){var t=a(f(J,e).y,0,$);Q[0]=($-t)/$,ee.style.top=t-B/2+"px",i(e)}function g(e){var t=f(K,e),n=a(t.x,0,M),o=a(t.y,0,V);Q[1]=1-(M-n)/M,Q[2]=(V-o)/V,te.style.right=M-n-I/2+"px",te.style.top=o-q/2+"px",i(e)}function T(e){re&&(d(e),ue=u(Q),ne||(L("drag:h",[ue,D]),L("drag",[ue,D]),P("h",[ue,D]))),ie&&(g(e),ue=u(Q),oe||(L("drag:sv",[ue,D]),L("drag",[ue,D]),P("sv",[ue,D]))),ne=0,oe=0}function b(e){var t=e.target,n=re?"h":"sv",o=[u(Q),D],r=t===s||m(t,s)===s,i=t===U||m(t,U)===U;r||i?i&&(L("stop:"+n,o),L("stop",o),P(n,o)):S()&&c!==!1&&(D.exit(),L("exit",[D]),P(0,o)),re=0,ie=0}function O(e){ne=1,re=1,T(e),v(e),L("start:h",[ue,D]),L("start",[ue,D]),P("h",[ue,D])}function R(e){oe=1,ie=1,T(e),v(e),L("start:sv",[ue,D]),L("start",[ue,D]),P("sv",[ue,D])}n||((o||z).appendChild(U),D.visible=!0),ce=E(U).w,le=E(U).h;var y=E(K),H=E(te),$=E(J).h,M=y.w,V=y.h,B=E(ee).h,I=H.w,q=H.h;n?(U.style.right=U.style.top="-9999px",c!==!1&&p(c,s,r),D.create=function(){return k(1),L("create",[D]),D},D.destroy=function(){return c!==!1&&h(c,s,r),D.exit(),A(!1),L("destroy",[D]),D}):N(),Z=function(){Q=w(Q),i(),ee.style.top=$-B/2-$*+Q[0]+"px",te.style.right=M-I/2-M*+Q[1]+"px",te.style.top=V-q/2-V*+Q[2]+"px"},D.exit=function(n){return S()&&(S().removeChild(U),D.visible=!1),x.any()?(h(_,J,O),h(_,K,R),h(F,t,T),h(G,t,b)):(h(X,J,O),h(X,K,R),h(j,t,T),h(Y,t,b)),h(W,e,N),h(on_orientationchange,e,C),D},Z(),n||(x.any()?(p(_,J,O),p(_,K,R),p(F,t,T),p(G,t,b)):(p(X,J,O),p(X,K,R),p(j,t,T),p(Y,t,b)),p(W,e,N),p(on_orientationchange,e,C))}function C(){new Promise(function(e){setTimeout(e,500)}).then(function(){return D.fit()})}function N(){return D.fit()}var z=t.body,V=t.documentElement,D=this,B=!1,I={},U=t.createElement("div"),X="mousedown",_="touchstart",j="mousemove",F="touchmove",Y="mouseup",G="touchend",W="resize";if(on_orientationchange="orientationchange",!(D instanceof CP))return new CP(s,c);CP[g][s.id||s.name||i(CP[g])]=D,n(c)||(c=X),A(CP.parse(s.getAttribute("data-color")||s.value||[0,1,1])),U.className="color-picker",U.innerHTML='<div class="color-picker-control"><span class="color-picker-h"><i></i></span><span class="color-picker-sv"><i></i></span></div>';var Z,q=U[T].children,Q=w([0,1,1]),J=q[0],K=q[1],ee=J[T],te=K[T],ne=0,oe=0,re=0,ie=0,ae=0,se=0,ce=0,le=0,ue=u(Q);return k(1),H(function(){var e=[u(Q),D];L("create",e),P(0,e)},0),D.fit=function(t){var o=E(e),i=E(V),a=i.h>o.h,c=d(e),l=(d(V),a?i.w:o.w+c.l),u=a?o.h+c.t:Math.max(i.h,o.h),p=d(s);return ae=p.l,se=p.t+E(s).h,r(t)?(n(t[0])&&(ae=t[0]),n(t[1])&&(se=t[1])):(ae+ce>l&&(ae=l-ce),se+le>u&&(se=u-le)),U.style.right="65px",U.style.top=se-35+"px",L("fit",[D]),D},D.set=function(e){return n(e)?(o(e)&&(e=CP.parse(e)),A(e),Z(),D):w()},D.target=s,D.picker=U,D.visible=!1,D.on=$,D.off=M,D.trigger=L,D.hooks=I,D.enter=function(e){return k(0,e)},D})}(window,document),THREE.OrbitControls=function(e,t){function n(e){e.preventDefault()}function o(e){e.preventDefault(),e.button===p.mouseControls.ROTATE?(T.set(e.clientX,e.clientY),f=h.ROTATE):e.button===p.mouseControls.ZOOM?(E.set(e.clientX,e.clientY),f=h.ZOOM):e.button===p.mouseControls.PAN&&(R.set(e.clientX,e.clientY),f=h.PAN),f!==h.NONE&&(document.addEventListener("mousemove",r,!1),document.addEventListener("mouseup",i,!1))}function r(e){e.preventDefault(),f===h.ROTATE?(b.set(e.clientX,e.clientY),O.subVectors(b,T),m.theta-=2*Math.PI*O.x/t.clientWidth*p.rotateSpeed,m.phi-=2*Math.PI*O.y/t.clientHeight*p.rotateSpeed,T.copy(b)):f===h.ZOOM?(w.set(e.clientX,e.clientY),g.subVectors(w,E),g.y>0?v/=Math.pow(.95,p.zoomSpeed):g.y<0&&(v*=Math.pow(.95,p.zoomSpeed)),E.copy(w)):f===h.PAN&&(y.set(e.clientX,e.clientY),H.subVectors(y,R),A(H.x,H.y),R.copy(y)),p.update()}function i(e){document.removeEventListener("mousemove",r,!1),document.removeEventListener("mouseup",i,!1),f=h.NONE}function a(e){f!==h.NONE&&f!==h.ROTATE||(e.preventDefault(),e.stopPropagation(),e.deltaY<0?v*=Math.pow(.95,p.zoomSpeed):e.deltaY>0&&(v/=Math.pow(.95,p.zoomSpeed)),p.update())}function s(e){if(1===e.touches.length)T.set(e.touches[0].pageX,e.touches[0].pageY),f=h.TOUCH_ROTATE;else if(2===e.touches.length){var t=e.touches[0].pageX-e.touches[1].pageX,n=e.touches[0].pageY-e.touches[1].pageY;E.set(0,Math.sqrt(t*t+n*n)),f=h.TOUCH_ZOOM}else 3===e.touches.length?(R.set(e.touches[0].pageX,e.touches[0].pageY),f=h.TOUCH_PAN):f=h.NONE}function c(e){if(e.preventDefault(),e.stopPropagation(),1===e.touches.length&&f===h.TOUCH_ROTATE)b.set(e.touches[0].pageX,e.touches[0].pageY),O.subVectors(b,T),m.theta-=2*Math.PI*O.x/t.clientWidth*p.rotateSpeed,m.phi-=2*Math.PI*O.y/t.clientHeight*p.rotateSpeed,T.copy(b);else if(2===e.touches.length&&f===h.TOUCH_ZOOM){var n=e.touches[0].pageX-e.touches[1].pageX,o=e.touches[0].pageY-e.touches[1].pageY;w.set(0,Math.sqrt(n*n+o*o)),g.subVectors(w,E),g.y>0?v*=Math.pow(.95,p.zoomSpeed):g.y<0&&(v/=Math.pow(.95,p.zoomSpeed)),E.copy(w)}else 3===e.touches.length&&f===h.TOUCH_PAN?(y.set(e.touches[0].pageX,e.touches[0].pageY),H.subVectors(y,R),A(H.x,H.y),R.copy(y)):f=h.NONE;p.update()}function l(e){f=h.NONE}function u(e){switch(e.keyCode){case p.keyboardControls.ROTATEUP:m.phi-=p.rotateSpeed/4;break;case p.keyboardControls.ROTATEDOWN:m.phi+=p.rotateSpeed/4;break;case p.keyboardControls.ROTATELEFT:m.theta-=p.rotateSpeed/4;break;case p.keyboardControls.ROTATERIGHT:m.theta+=p.rotateSpeed/4;break;case p.keyboardControls.ZOOMIN:v*=Math.pow(.95,2*p.zoomSpeed);break;case p.keyboardControls.ZOOMOUT:v/=Math.pow(.95,2*p.zoomSpeed);break;case p.keyboardControls.PANUP:A(0,-p.panSpeed);break;case p.keyboardControls.PANDOWN:A(0,p.panSpeed);break;case p.keyboardControls.PANLEFT:A(-p.panSpeed,0);break;case p.keyboardControls.PANRIGHT:A(p.panSpeed,0)}p.update()}this.object=e,this.renderer=t,this.pivot=new THREE.Vector3,this.zoomMin=2,this.zoomMax=800,this.zoomSpeed=.5,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.rotateSpeed=1,this.panSpeed=7,this.mouseControls={ROTATE:THREE.MOUSE.LEFT,ZOOM:THREE.MOUSE.MIDDLE,PAN:THREE.MOUSE.RIGHT},this.keyboardControls={ZOOMIN:90,ZOOMOUT:88,PANLEFT:65,PANUP:87,PANRIGHT:68,PANDOWN:83,ROTATELEFT:37,ROTATEUP:38,ROTATERIGHT:39,ROTATEDOWN:40},this.pivotReset=this.pivot.clone(),this.positionReset=this.object.position.clone(),this.zoomReset=this.object.zoom,this.update=function(){var t=new THREE.Vector3,n=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),o=n.clone().inverse(),r=p.object.position;t.copy(r).sub(p.pivot),t.applyQuaternion(n),d.setFromVector3(t),d.theta+=m.theta,d.phi+=m.phi,d.theta=Math.max(p.minAzimuthAngle,Math.min(p.maxAzimuthAngle,d.theta)),d.phi=Math.max(p.minPolarAngle,Math.min(p.maxPolarAngle,d.phi)),d.makeSafe(),d.radius=Math.max(p.zoomMin,Math.min(p.zoomMax,d.radius*v)),p.pivot.add(x),t.setFromSpherical(d),t.applyQuaternion(o),r.copy(p.pivot).add(t),p.object.lookAt(p.pivot),m.set(0,0,0),v=1,x.set(0,0,0)},this.reset=function(){p.pivot.copy(p.pivotReset),p.object.position.copy(p.positionReset),p.object.zoom=p.zoomReset,p.update(),f=h.NONE};var p=this,h={NONE:-1,ROTATE:0,ZOOM:1,PAN:2,TOUCH_ROTATE:3,TOUCH_ZOOM:4,TOUCH_PAN:5},f=h.NONE,d=new THREE.Spherical,m=new THREE.Spherical,v=1,E=new THREE.Vector2,w=new THREE.Vector2,g=new THREE.Vector2,T=new THREE.Vector2,b=new THREE.Vector2,O=new THREE.Vector2,R=new THREE.Vector2,y=new THREE.Vector2,H=new THREE.Vector2,x=new THREE.Vector3,A=function(e,n){var o=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3;o.copy(p.object.position).sub(p.pivot);var a=o.length();a*=Math.tan(p.object.fov/2*Math.PI/180),r.setFromMatrixColumn(p.object.matrix,0),i.setFromMatrixColumn(p.object.matrix,1),r.multiplyScalar(-(2*e*a/t.clientHeight)),i.multiplyScalar(2*n*a/t.clientHeight),x.add(r),x.add(i)};p.renderer.addEventListener("contextmenu",n,!1),p.renderer.addEventListener("mousedown",o,!1),p.renderer.addEventListener("wheel",a,!1),p.renderer.addEventListener("touchstart",s,!1),p.renderer.addEventListener("touchend",l,!1),p.renderer.addEventListener("touchmove",c,!1),window.addEventListener("keydown",u,!1),this.update()};var controller3D;$(function(){controller3D=new controller3D,controller3D.init()}),$(function(){$(window).resize(function(){$(".help.wrapper .help.menu").css("left",(window.innerWidth-$(".help.wrapper .help.menu").width())/2),$(".scroll").perfectScrollbar("update")}),$(window).on("orientationchange",function(){setTimeout(function(){$(".help.wrapper .help.menu").css("left",(window.innerWidth-$(".help.wrapper .help.menu").width())/2)},500)}),$(".navbar.right .help.icon").click(function(e){e.preventDefault(),$(".help.wrapper").fadeIn("slow"),$(".help.wrapper .help.menu").css("left",(window.innerWidth-$(".help.wrapper .help.menu").width())/2),setTimeout(function(){$(".help.content").scrollTop(0),$(".help.content").scrollLeft(0),$(".scroll").perfectScrollbar("update")},10)}),$(".help.wrapper .help.leftover").on("mousedown touchstart",function(e){e.preventDefault(),$(".help.wrapper").fadeOut("slow")})}),$(function(){$(".scroll").perfectScrollbar({minScrollbarLength:20})});